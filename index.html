<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="main.css" />
        <title>SnakeAI</title>
        <script src="SnakeAI.js"></script>
        <script src="rng.js"></script>
        <script>
            let worker, board;
            let replay = {snake: null, generation: null};
            function nextFrame() {
                if (!replay.snake) {
                    return;
                }
                if (nextState(replay.snake) == "died") {
                    replay.snake = null;
                    worker.postMessage("");
                    return;
                }
                draw(replay.snake, `generation ${replay.generation}`, board);
            }
            function handleWorkerMessage({data: {generation, brain}}) {
                replay.generation = generation;
                replay.snake = birth(brain);
            }
            function DomLoad() {
                board = document.querySelector("#board").getContext("2d");
                worker = new Worker("EvolutionWorker.js");
                worker.addEventListener("message", handleWorkerMessage);
                worker.postMessage("");
                setInterval(nextFrame, 20);
            }
        </script>
    </head>
    <body onload="DomLoad()">
        <canvas id="board" width="500" height="500"></canvas>
    </body>
</html>
